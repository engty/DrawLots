# 产品需求文档（Product Requirements Document）

## 1. 产品概述
- **产品名称**：员工满意度调查抽选系统
- **产品定位**：智能化、公平性的员工抽样系统，确保满意度调查的科学性和代表性
- **目标用户**：公司HR部门工作人员
- **核心问题**：解决传统手工抽选效率低、公平性难保证、历史记录管理混乱的问题

## 2. 用户分析
| 用户类型 | 用户特征 | 核心需求 | 使用场景 |
|:--------:|:--------:|:--------:|:--------:|
| HR工作人员 | 需要定期组织满意度调查，对Excel操作熟练，追求效率和公平性 | 快速、公平、可控的员工抽选流程 | 每季度进行满意度调查人员抽选 |

## 3. 页面架构
### 3.1 页面清单
| 页面名称 | 页面类型 | 核心功能 | 用户价值 | 用户入口 | 优先级 |
|:--------:|:--------:|:--------:|:--------:|:--------:|:--------:|
| 主页面 | 功能页 | 文件上传和抽选控制 | 一站式操作入口 | 应用启动 | P0 |
| 抽选结果页 | 结果页 | 按部门展示抽选结果，支持删除和补充 | 可视化结果展示和精细化控制 | 主页面抽选后 | P0 |
| 历史记录管理页 | 管理页 | 查看和编辑历史抽选记录 | 降权机制维护和记录追溯 | 主页面菜单 | P1 |

### 3.2 页面详细需求
#### 页面1：主页面
- **页面目标**：用户能够快速上传员工名册并启动抽选流程
- **核心功能**：
  - Excel文件上传和解析
  - 部门列表展示和人数设置
  - 运行部特殊分部门选择机制
  - 一键启动抽选功能
- **业务逻辑**：
  - 只接受.xlsx格式文件
  - 自动读取"公司员工花名册"工作表
  - 只统计在岗员工
  - 按部门人数自动计算应抽人数
  - 运行部需要特殊处理：用户可选择参与抽选的分部门
- **页面元素**：
  - 文件选择按钮
  - 文件解析状态提示
  - 部门列表和应抽人数展示
  - 运行部分部门选择区域（复选框组）
  - "开始抽选"按钮
  - 历史记录入口
- **交互逻辑**：
  1. 用户选择Excel文件 → 系统自动解析
  2. 显示部门统计信息 → 用户确认
  3. 如有运行部，显示分部门选择界面 → 用户勾选参与分部门
  4. 点击开始抽选 → 跳转结果页面
- **跳转逻辑**：抽选完成后跳转到抽选结果页

#### 页面2：抽选结果页
- **页面目标**：展示抽选结果并支持精细化调整
- **核心功能**：
  - 按部门分组显示抽选人员
  - 支持手动删除特定人员
  - 智能补充抽选机制
  - 最终名单导出和保存
- **业务逻辑**：
  - 抽选结果按部门分组展示
  - 每个人员后有删除按钮
  - 删除后总人数减少，显示"继续补充抽取"按钮
  - 补充时只从被删人员的部门重新抽选
  - 被删除人员在本次抽选中永久排除
  - 未删除人员保持不变
- **页面元素**：
  - 部门分组标题
  - 人员列表（姓名 + [x]删除按钮）
  - 当前总人数统计
  - "继续补充抽取"按钮
  - "保存人员名单"按钮
  - 返回主页按钮
- **交互逻辑**：
  1. 显示初次抽选结果
  2. 用户删除不合适人员
  3. 点击补充抽取 → 系统分析删除的部门 → 重新抽选补充
  4. 重复调整直到满意
  5. 保存最终名单
- **跳转逻辑**：保存完成后返回主页面，或跳转历史记录页

#### 页面3：历史记录管理页
- **页面目标**：管理历史抽选记录，支持降权机制维护
- **核心功能**：
  - 历史记录列表展示
  - 记录详情查看
  - 记录编辑和删除
  - 降权状态可视化
- **业务逻辑**：
  - 按时间倒序显示历史记录
  - 显示每次抽选的基本信息（日期、总人数、部门分布）
  - 支持查看详细抽选名单
  - 支持手动修改历史记录（影响降权计算）
  - 显示每个员工的降权状态
- **页面元素**：
  - 历史记录列表
  - 记录详情弹窗
  - 编辑和删除按钮
  - 降权状态指示器
  - 返回主页按钮
- **交互逻辑**：
  1. 展示历史记录列表
  2. 点击记录查看详情
  3. 编辑记录影响降权计算
  4. 删除记录同步更新降权状态
- **跳转逻辑**：返回主页面

## 4. 用户故事
### P0核心功能：
- 作为HR，我希望能够上传员工Excel名册并自动解析部门信息，以便快速获取可抽选的员工数据
- 业务规则：只处理"公司员工花名册"工作表，统计部门为‘厂部’和‘总工室’的两个部门以外，其他部门的在岗员工，并排除岗位为‘实习生’和‘长假人员’的人员，按部门自动计算抽选人数

- 作为HR，我希望系统能按照既定规则自动抽选各部门人员，以便确保抽选的公平性和科学性
- 业务规则：≤10人抽1人，11-20人抽2人，21-50人抽3人，51-100人抽4人，>100人抽8人

- 作为HR，我希望能够选择运行部中参与抽选的特定分部门，以便根据实际业务需要灵活控制抽选范围
- 业务规则：运行部包含7个分部门，其中运行部办公室和运管环化分部默认参与，其余5个分部门(运行A值、B值、C值、D值、F值)可选择性参与

- 作为HR，我希望能够手动删除不合适的人员并智能补充，以便最终获得满意的抽选名单
- 业务规则：删除后只从对应部门补充，被删人员本次不再参与，其他人员保持不变

### P1重要功能：
- 作为HR，我希望系统能够考虑历史抽选记录进行降权处理，以便确保长期的公平性
- 业务规则：在前两次被抽中过的人员，本次抽中概率为1%，3次前及以上为正常概率

- 作为HR，我希望能够管理和编辑历史抽选记录，以便在特殊情况下调整降权机制
- 业务规则：手动修改历史记录会影响降权计算，删除记录会同步更新所有相关降权状态

## 5. 用户流程
### 主要操作路径：
1. 启动应用 → 2. 上传Excel文件 → 3. 确认部门信息 → 4. 选择运行部参与分部门（如有） → 5. 开始抽选 → 6. 查看结果 → 7. 手动调整（可选） → 8. 保存名单

### 页面流转图：
主页面 → 抽选结果页 → 历史记录管理页 → 主页面

### 补充抽选流程：
抽选结果页 → 删除人员 → 点击"继续补充抽取" → 系统分析缺失部门 → 重新抽选补充 → 更新结果展示

## 6. 产品约束
- **平台要求**：跨平台桌面应用，支持Windows、macOS、Linux系统
- **功能边界**：
  - 只处理.xlsx格式的Excel文件
  - 固定的工作表名称："公司员工花名册"
  - 固定的列结构要求
  - 只支持单用户使用，无需网络功能
- **内容规范**：
  - Excel文件必须包含：序号、工号、姓名、性别、年龄、最高学历、部门、分部门、岗位、在职状态、备注共11列
  - 系统只提取：姓名、性别、部门、分部门、在职状态这5列数据
  - 只处理在职状态为"在岗"，并且岗位不为‘实习生’和‘长假人员’的员工
  - 不处理部门为‘厂部’和‘总工室’的员工
- **技术约束**：
  - 推荐使用HTML5 + CSS3 + JavaScript ES6+技术栈开发
  - 需要处理Excel文件读取和解析
  - 需要实现加权随机抽样算法
  - 需要本地文件系统进行历史记录存储
  - 导出格式固定为Markdown(.md)格式
- **业务约束**：
  - 降权机制基于4个季度(1年)的时间周期
  - 部门人员不足4人时，即使降权也必须能被抽中
  - 历史记录按日期命名存储在history文件夹中
  - 每次抽选必须满足各部门的最小人数要求
- **运行部特殊规则**：
  - 运行部包含7个分部门：运行部办公室、运管环化分部、运行A值、运行B值、运行C值、运行D值、运行F值
  - 运行部办公室和运管环化分部默认参与抽选
  - 运行A值、B值、C值、D值、F值需要用户手动选择是否参与
  - 只有被选中的分部门人员才会参与抽选
  - 未选中的分部门人员在本次抽选中完全排除